(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{2124:(e,t,i)=>{Promise.resolve().then(i.bind(i,3533))},3533:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>k});var r=i(3365),d=i(627),o=i(1521);async function n(e,t){if(!("indexedDB"in window))throw Error("IndexedDB not available");let i=await new Promise((e,t)=>{let i=indexedDB.open("pdf-storage",1);i.onupgradeneeded=()=>{let e=i.result;e.objectStoreNames.contains("pdfs")||e.createObjectStore("pdfs")},i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)});await new Promise((r,d)=>{let o=i.transaction("pdfs","readwrite").objectStore("pdfs"),n=new Blob([t],{type:"application/pdf"}),a=o.put(n,e);a.onsuccess=()=>r(),a.onerror=()=>d(a.error)})}async function a(e){if(!("indexedDB"in window))return null;let t=await new Promise((e,t)=>{let i=indexedDB.open("pdf-storage",1);i.onupgradeneeded=()=>{let e=i.result;e.objectStoreNames.contains("pdfs")||e.createObjectStore("pdfs")},i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)}),i=await new Promise((i,r)=>{let d=t.transaction("pdfs","readonly").objectStore("pdfs").get(e);d.onsuccess=()=>i(d.result||null),d.onerror=()=>r(d.error)});return i?await i.arrayBuffer():null}async function l(e){let t=new Blob([e],{type:"application/pdf"}),i=await new Promise((e,i)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=()=>i(r.error),r.readAsDataURL(t)}),r=i.indexOf(",");return r>=0?i.slice(r+1):i}async function s(e){let t=await fetch("data:application/pdf;base64,".concat(e));return await t.arrayBuffer()}async function p(e){try{let t=await a(e);if(t)return t}catch(e){}let t=localStorage.getItem("pdf:".concat(e));return t?await s(t):null}async function c(e,t){try{return await n(e,t),"idb"}catch(i){return await l(t).then(t=>{localStorage.setItem("pdf:".concat(e),t)}),"localStorage"}}var u=i(9706),x=i(688);let b=(0,x.default)(()=>Promise.all([i.e(87),i.e(956)]).then(i.bind(i,9936)).then(e=>e.Document),{loadableGenerated:{webpack:()=>[9936]},ssr:!1}),h=(0,x.default)(()=>Promise.all([i.e(87),i.e(956)]).then(i.bind(i,9936)).then(e=>e.Page),{loadableGenerated:{webpack:()=>[9936]},ssr:!1});function f(e){let{pdfData:t,onFieldsExtracted:d,selectedFields:n,onFieldClick:a,groupedFields:l=new Set,linkingMode:s=!1}=e,[p,c]=(0,o.useState)(0),[u,x]=(0,o.useState)(1),[f,y]=(0,o.useState)(1),[m,g]=(0,o.useState)([]),[_,v]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{{let{pdfjs:e}=await Promise.all([i.e(87),i.e(956)]).then(i.bind(i,9936));e.GlobalWorkerOptions.workerSrc="/pdf.worker.min.js"}})()},[]);let j=(0,o.useCallback)(async()=>{try{let{pdfjs:e}=await Promise.all([i.e(87),i.e(956)]).then(i.bind(i,9936)),r=t.slice(0),o=e.getDocument({data:r}),n=await o.promise,a=[];for(let e=1;e<=n.numPages;e++){let t=await n.getPage(e);(await t.getAnnotations()).forEach(t=>{if(t.fieldType){var i;let r="text";"Tx"===t.fieldType?r="text":"Ch"===t.fieldType?r=t.checkBox?"checkbox":"radio":"Sig"===t.fieldType?r="signature":"Btn"===t.fieldType&&(r=t.checkBox?"checkbox":t.radioButton?"radio":"button");let d={name:t.fieldName||"field_".concat(e,"_").concat(t.id),type:r,page:e,rect:t.rect,value:t.fieldValue,options:null==(i=t.options)?void 0:i.map(e=>e.displayValue||e.exportValue)};a.push(d)}})}g(a),d(a)}catch(e){console.error("Error extracting form fields:",e)}},[t,d]);return(0,o.useEffect)(()=>{j(),v(!1)},[j]),(0,r.jsxs)("div",{className:"pdf-viewer-container",style:{position:"relative",height:"100%",overflow:"auto"},children:[(0,r.jsxs)("div",{style:{padding:"10px",borderBottom:"1px solid #ccc",background:"#f5f5f5"},children:[(0,r.jsx)("button",{onClick:()=>x(Math.max(1,u-1)),disabled:u<=1,children:"Previous"}),(0,r.jsxs)("span",{style:{margin:"0 10px"},children:["Page ",u," of ",p]}),(0,r.jsx)("button",{onClick:()=>x(Math.min(p,u+1)),disabled:u>=p,children:"Next"}),(0,r.jsxs)("span",{style:{marginLeft:"20px"},children:["Zoom:",(0,r.jsx)("button",{onClick:()=>y(f-.1),style:{marginLeft:"5px"},children:"-"}),(0,r.jsxs)("span",{style:{margin:"0 10px"},children:[Math.round(100*f),"%"]}),(0,r.jsx)("button",{onClick:()=>y(f+.1),children:"+"})]})]}),(0,r.jsxs)("div",{style:{position:"relative",padding:"20px"},children:[_?(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:"Loading PDF..."}):t?(0,r.jsx)(b,{file:t.slice(0),onLoadSuccess:function(e){let{numPages:t}=e;c(t)},children:(0,r.jsx)(h,{pageNumber:u,scale:f,renderAnnotationLayer:!1,renderTextLayer:!1})}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:"No PDF data available"}),m.filter(e=>e.page===u).map((e,t)=>{let[i,d,o,p]=e.rect,c=n.has(e.name),u=l.has(e.name),x="#9ca3af",b="rgba(156, 163, 175, 0.1)",h="rgba(156, 163, 175, 0.2)";return c?(x="#2563eb",b="rgba(37, 99, 235, 0.1)",h="rgba(37, 99, 235, 0.2)"):u&&(s?(x="#10b981",b="rgba(16, 185, 129, 0.1)",h="rgba(16, 185, 129, 0.3)"):(x="#8b5cf6",b="rgba(139, 92, 246, 0.1)",h="rgba(139, 92, 246, 0.2)")),(0,r.jsx)("div",{onClick:()=>a(e),style:{position:"absolute",left:"".concat(i*f+20,"px"),bottom:"".concat(d*f+20,"px"),width:"".concat((o-i)*f,"px"),height:"".concat((p-d)*f,"px"),border:"2px solid ".concat(x),backgroundColor:b,cursor:s&&u?"crosshair":"pointer",transition:"all 0.2s"},title:"".concat(e.name," (").concat(e.type,")").concat(u?" - GROUPED":""),onMouseEnter:e=>{e.currentTarget.style.backgroundColor=h},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=b}},"".concat(e.name,"_").concat(t,"_").concat(e.page))})]})]})}function y(e){let{selectedFields:t,onCreateGroup:i,onCancel:d}=e,[n,a]=(0,o.useState)(""),[l,s]=(0,o.useState)(""),p=(()=>{if(0===t.length)return[];if(1===new Set(t.map(e=>e.type)).size){let e=t[0].type;if("text"===e)return[{value:"text-continuation",label:"Text Continuation (single value across multiple fields)"},{value:"text-same-value",label:"Same Value Linked Fields (duplicate value in each field)"}];if("checkbox"===e)return[{value:"checkbox",label:"Checkbox Group"}];if("radio"===e)return[{value:"radio",label:"Radio Button Group"}]}return[]})();return(0,r.jsxs)("div",{style:{position:"fixed",right:"20px",top:"50%",transform:"translateY(-50%)",width:"400px",background:"white",border:"1px solid #ccc",borderRadius:"8px",padding:"20px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3},children:[(0,r.jsx)("h3",{style:{marginTop:0},children:"Create Field Group"}),(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsxs)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:["Selected Fields (",t.length,"):"]}),(0,r.jsx)("div",{style:{maxHeight:"150px",overflow:"auto",border:"1px solid #e5e7eb",borderRadius:"4px",padding:"8px"},children:t.map(e=>(0,r.jsxs)("div",{style:{padding:"4px",background:"#f3f4f6",marginBottom:"4px",borderRadius:"2px",fontSize:"14px"},children:[e.name," (",e.type,")"]},e.name))})]}),p.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Group Type:"}),(0,r.jsxs)("select",{value:n,onChange:e=>a(e.target.value),style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"},children:[(0,r.jsx)("option",{value:"",children:"Select a type..."}),p.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Display Name:"}),(0,r.jsx)("input",{type:"text",value:l,onChange:e=>s(e.target.value),placeholder:"Enter display name for this group",style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"}})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[(0,r.jsx)("button",{onClick:d,style:{padding:"8px 16px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer"},children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{if(!n||!l)return void alert("Please select a group type and enter a display name");i({fields:t,groupType:n,displayName:l})},style:{padding:"8px 16px",border:"none",borderRadius:"4px",background:"#2563eb",color:"white",cursor:"pointer"},children:"Create Group"})]})]}):(0,r.jsx)("div",{style:{color:"#6b7280",textAlign:"center",padding:"20px"},children:"Please select fields of the same type to create a group."})]})}function m(e){var t,i,d;let{item:n,onSave:a,onCancel:l,onStartLinking:s,linkingMode:p}=e,[c,u]=(0,o.useState)(JSON.parse(JSON.stringify(n))),x=(e,t,i)=>{let r={...c};r.display_attributes.checkbox_options||(r.display_attributes.checkbox_options={options:[]}),r.display_attributes.checkbox_options.options[e]||(r.display_attributes.checkbox_options.options[e]={display_name:"",databaseStored:"",linkedFields:[]}),r.display_attributes.checkbox_options.options[e][t]=i,u(r)},b=(e,t,i)=>{let r={...c};r.pdf_attributes||(r.pdf_attributes=[]),r.pdf_attributes[e]||(r.pdf_attributes[e]={formType:"",formfield:""}),r.pdf_attributes[e][t]=i,u(r)};return(0,r.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",padding:"16px",marginBottom:"16px",background:"#f9fafb",maxHeight:"70vh",overflowY:"auto"},children:[(0,r.jsx)("h4",{style:{marginBottom:"12px",fontWeight:"bold"},children:"Basic Properties"}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Unique ID:"}),(0,r.jsx)("input",{type:"text",value:c.unique_id||"",onChange:e=>u({...c,unique_id:e.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Display Name (Required):"}),(0,r.jsx)("input",{type:"text",value:c.display_attributes.display_name||"",onChange:e=>u({...c,display_attributes:{...c.display_attributes,display_name:e.target.value}}),style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Order (Required):"}),(0,r.jsx)("input",{type:"number",value:c.display_attributes.order,onChange:e=>u({...c,display_attributes:{...c.display_attributes,order:parseInt(e.target.value)||0}}),style:{width:"100px",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Input Type:"}),(0,r.jsxs)("select",{value:c.display_attributes.input_type,onChange:e=>u({...c,display_attributes:{...c.display_attributes,input_type:e.target.value}}),style:{width:"200px",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"},children:[(0,r.jsx)("option",{value:"text",children:"Text"}),(0,r.jsx)("option",{value:"text-area",children:"Text Area"}),(0,r.jsx)("option",{value:"radio",children:"Radio"}),(0,r.jsx)("option",{value:"checkbox",children:"Checkbox"}),(0,r.jsx)("option",{value:"signature",children:"Signature"}),(0,r.jsx)("option",{value:"fileUpload",children:"File Upload"}),(0,r.jsx)("option",{value:"info",children:"Info"})]})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Value Type:"}),(0,r.jsxs)("select",{value:c.display_attributes.value.type,onChange:e=>u({...c,display_attributes:{...c.display_attributes,value:{...c.display_attributes.value,type:e.target.value}}}),style:{width:"200px",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"},children:[(0,r.jsx)("option",{value:"manual",children:"Manual"}),(0,r.jsx)("option",{value:"resolved",children:"Resolved (from database)"}),(0,r.jsx)("option",{value:"reserved",children:"Reserved (computed)"})]})]}),"resolved"===c.display_attributes.value.type&&(0,r.jsxs)("div",{style:{marginBottom:"12px",paddingLeft:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Database Configuration (Supabase):"}),(0,r.jsx)("textarea",{value:JSON.stringify(c.display_attributes.value.supabase||[],null,2),onChange:e=>{try{let t=JSON.parse(e.target.value);u({...c,display_attributes:{...c.display_attributes,value:{...c.display_attributes.value,supabase:t}}})}catch(e){}},placeholder:'[{"table": "users", "column": "name", "eqBy": []}]',style:{width:"100%",minHeight:"80px",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px",fontFamily:"monospace",fontSize:"12px"}})]}),"reserved"===c.display_attributes.value.type&&(0,r.jsxs)("div",{style:{marginBottom:"12px",paddingLeft:"20px"},children:[(0,r.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"4px"},children:"Reserved Field:"}),(0,r.jsxs)("select",{value:c.display_attributes.value.reserved||"",onChange:e=>u({...c,display_attributes:{...c.display_attributes,value:{...c.display_attributes.value,reserved:e.target.value}}}),style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"},children:[(0,r.jsx)("option",{value:"",children:"Select a reserved field"}),(0,r.jsx)("option",{value:"landlord_name_csv",children:"Landlord Name CSV"}),(0,r.jsx)("option",{value:"tenant_name_csv",children:"Tenant Name CSV"}),(0,r.jsx)("option",{value:"realtor_name_spaced",children:"Realtor Name Spaced"}),(0,r.jsx)("option",{value:"property_street_address",children:"Property Street Address"}),(0,r.jsx)("option",{value:"buyer/tenant_name_csv",children:"Buyer/Tenant Name CSV"}),(0,r.jsx)("option",{value:"buyer/tenant_phone_number",children:"Buyer/Tenant Phone Number"}),(0,r.jsx)("option",{value:"landlord_phone_number",children:"Landlord Phone Number"})]})]}),"checkbox"===c.display_attributes.input_type&&(0,r.jsxs)("details",{style:{marginBottom:"12px"},open:!0,children:[(0,r.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Checkbox Options"}),(0,r.jsxs)("div",{style:{marginTop:"8px",paddingLeft:"16px"},children:[null==(t=c.display_attributes.checkbox_options)?void 0:t.options.map((e,t)=>(0,r.jsxs)("div",{style:{border:"1px solid #d1d5db",borderRadius:"4px",padding:"8px",marginBottom:"8px"},children:[(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("input",{type:"text",value:e.display_name,onChange:e=>x(t,"display_name",e.target.value),placeholder:"Display Name",style:{width:"45%",marginRight:"10px",padding:"4px",border:"1px solid #d1d5db",borderRadius:"4px"}}),(0,r.jsx)("input",{type:"text",value:e.databaseStored,onChange:e=>x(t,"databaseStored",e.target.value),placeholder:"Database Value",style:{width:"45%",padding:"4px",border:"1px solid #d1d5db",borderRadius:"4px"}}),(0,r.jsx)("button",{onClick:()=>(e=>{var t;let i={...c};(null==(t=i.display_attributes.checkbox_options)?void 0:t.options)&&i.display_attributes.checkbox_options.options.splice(e,1),u(i)})(t),style:{marginLeft:"8px",padding:"4px 8px",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),(0,r.jsxs)("div",{style:{marginTop:"8px"},children:[(0,r.jsx)("label",{style:{fontSize:"14px",fontWeight:"bold"},children:"Linked Fields:"}),e.linkedFields&&e.linkedFields.length>0?(0,r.jsx)("div",{style:{marginTop:"4px"},children:e.linkedFields.map((e,i)=>(0,r.jsxs)("div",{style:{display:"inline-block",marginRight:"8px",marginTop:"4px",padding:"2px 8px",background:"#e5e7eb",borderRadius:"4px",fontSize:"12px"},children:[e,(0,r.jsx)("button",{onClick:()=>{var i,r;let d={...c};(null==(r=d.display_attributes.checkbox_options)||null==(i=r.options[t])?void 0:i.linkedFields)&&(d.display_attributes.checkbox_options.options[t].linkedFields=d.display_attributes.checkbox_options.options[t].linkedFields.filter(t=>t!==e),u(d))},style:{marginLeft:"4px",background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",fontWeight:"bold"},children:"\xd7"})]},i))}):(0,r.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"No linked fields"}),s&&(0,r.jsx)("button",{onClick:()=>{a(c),s("".concat(c.unique_id,".").concat(t))},disabled:(null==p?void 0:p.checkboxOptionPath)==="".concat(c.unique_id,".").concat(t),style:{marginTop:"8px",padding:"4px 8px",background:(null==p?void 0:p.checkboxOptionPath)==="".concat(c.unique_id,".").concat(t)?"#fbbf24":"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:(null==p?void 0:p.checkboxOptionPath)==="".concat(c.unique_id,".").concat(t)?"not-allowed":"pointer",fontSize:"12px"},children:(null==p?void 0:p.checkboxOptionPath)==="".concat(c.unique_id,".").concat(t)?"\uD83D\uDD17 Linking Active - Click a field in PDF":"Add Linked Field"})]})]},t)),(0,r.jsx)("button",{onClick:()=>{let e={...c};e.display_attributes.checkbox_options||(e.display_attributes.checkbox_options={options:[]}),e.display_attributes.checkbox_options.options.push({display_name:"",databaseStored:"",linkedFields:[]}),u(e)},style:{padding:"4px 8px",background:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Add Option"})]})]}),"radio"===c.display_attributes.input_type&&(0,r.jsxs)("details",{style:{marginBottom:"12px"},open:!0,children:[(0,r.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Radio Options"}),(0,r.jsx)("div",{style:{marginTop:"8px",paddingLeft:"16px"},children:(0,r.jsx)("textarea",{value:(null==(i=c.display_attributes.display_radio_options)?void 0:i.join("\n"))||"",onChange:e=>u({...c,display_attributes:{...c.display_attributes,display_radio_options:e.target.value.split("\n").filter(e=>e.trim())}}),placeholder:"Enter radio options (one per line)",style:{width:"100%",minHeight:"80px",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"}})})]}),(0,r.jsxs)("details",{style:{marginBottom:"12px"},open:!0,children:[(0,r.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"PDF Attributes"}),(0,r.jsxs)("div",{style:{marginTop:"8px",paddingLeft:"16px"},children:[null==(d=c.pdf_attributes)?void 0:d.map((e,t)=>(0,r.jsxs)("div",{style:{border:"1px solid #d1d5db",borderRadius:"4px",padding:"8px",marginBottom:"8px"},children:[(0,r.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,r.jsx)("label",{style:{fontWeight:"bold"},children:"Form Type:"}),(0,r.jsx)("input",{type:"text",value:e.formType||"",onChange:e=>b(t,"formType",e.target.value),style:{marginLeft:"8px",padding:"4px",border:"1px solid #d1d5db",borderRadius:"4px"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,r.jsx)("label",{style:{fontWeight:"bold"},children:"Form Field:"}),Array.isArray(e.formfield)?(0,r.jsx)("textarea",{value:e.formfield.join("\n"),onChange:e=>b(t,"formfield",e.target.value.split("\n").filter(e=>e.trim())),placeholder:"Enter form fields (one per line)",style:{width:"100%",minHeight:"60px",marginTop:"4px",padding:"4px",border:"1px solid #d1d5db",borderRadius:"4px"}}):(0,r.jsx)("input",{type:"text",value:e.formfield||"",onChange:e=>b(t,"formfield",e.target.value),style:{marginLeft:"8px",padding:"4px",border:"1px solid #d1d5db",borderRadius:"4px"}})]}),e.linked_form_fields_text&&(0,r.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,r.jsx)("label",{style:{fontWeight:"bold"},children:"Linked Text Fields:"}),e.linked_form_fields_text.map((e,i)=>(0,r.jsxs)("div",{style:{marginTop:"4px"},children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>((e,t,i)=>{var r,d;let o={...c};(null==(d=o.pdf_attributes)||null==(r=d[e])?void 0:r.linked_form_fields_text)&&(o.pdf_attributes[e].linked_form_fields_text[t]=i,u(o))})(t,i,e.target.value),style:{width:"70%",padding:"4px",border:"1px solid #d1d5db",borderRadius:"4px"}}),(0,r.jsx)("button",{onClick:()=>((e,t)=>{var i,r;let d={...c};(null==(r=d.pdf_attributes)||null==(i=r[e])?void 0:i.linked_form_fields_text)&&(d.pdf_attributes[e].linked_form_fields_text.splice(t,1),u(d))})(t,i),style:{marginLeft:"8px",padding:"4px 8px",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]},i)),(0,r.jsx)("button",{onClick:()=>(e=>{var t;let i={...c};(null==(t=i.pdf_attributes)?void 0:t[e])&&(i.pdf_attributes[e].linked_form_fields_text||(i.pdf_attributes[e].linked_form_fields_text=[]),i.pdf_attributes[e].linked_form_fields_text.push(""),u(i))})(t),style:{marginTop:"4px",padding:"4px 8px",background:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Add Linked Field"})]}),e.linked_form_fields_checkbox&&(0,r.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,r.jsx)("label",{style:{fontWeight:"bold"},children:"Linked Checkbox Fields:"}),(0,r.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"(Edit these in the checkbox options above)"})]}),e.linked_form_fields_radio&&(0,r.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,r.jsx)("label",{style:{fontWeight:"bold"},children:"Linked Radio Fields:"}),(0,r.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"(Edit these in the radio options above)"})]})]},t)),(!c.pdf_attributes||0===c.pdf_attributes.length)&&(0,r.jsx)("button",{onClick:()=>{let e={...c};e.pdf_attributes||(e.pdf_attributes=[]),e.pdf_attributes.push({formType:"",formfield:""}),u(e)},style:{padding:"4px 8px",background:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Add PDF Attribute"})]})]}),(0,r.jsxs)("details",{style:{marginBottom:"12px"},children:[(0,r.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Additional Properties"}),(0,r.jsxs)("div",{style:{marginTop:"8px",paddingLeft:"16px"},children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",checked:c.display_attributes.isRequired||!1,onChange:e=>u({...c,display_attributes:{...c.display_attributes,isRequired:e.target.checked}})})," Required"]}),(0,r.jsx)("br",{}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",checked:c.display_attributes.isHidden||!1,onChange:e=>u({...c,display_attributes:{...c.display_attributes,isHidden:e.target.checked}})})," Hidden"]}),(0,r.jsx)("br",{}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",checked:c.display_attributes.isCached||!1,onChange:e=>u({...c,display_attributes:{...c.display_attributes,isCached:e.target.checked}})})," Cached"]})]})]}),(0,r.jsxs)("details",{style:{marginBottom:"12px"},children:[(0,r.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Raw JSON Editor"}),(0,r.jsxs)("div",{style:{marginTop:"8px"},children:[(0,r.jsx)("textarea",{value:JSON.stringify(c,null,2),onChange:e=>{try{let t=JSON.parse(e.target.value);u(t)}catch(e){}},style:{width:"100%",minHeight:"200px",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px",fontFamily:"monospace",fontSize:"12px"}}),(0,r.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"Warning: Invalid JSON will be ignored"})]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end",marginTop:"16px"},children:[(0,r.jsx)("button",{onClick:l,style:{padding:"6px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer"},children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>a(c),disabled:!c.display_attributes.display_name||!c.display_attributes.order,style:{padding:"6px 12px",border:"none",borderRadius:"4px",background:"#2563eb",color:"white",cursor:"pointer",opacity:c.display_attributes.display_name&&c.display_attributes.order?1:.5},children:"Save"})]})]})}function g(e){let{schema:t,onSchemaChange:i,fieldGroup:d,formType:n,onStartLinking:a,linkingMode:l}=e,[s,p]=(0,o.useState)(null),[c,u]=(0,o.useState)(null);o.useEffect(()=>{if(d){let e=(e=>{let i=e.fields[0],r={unique_id:i.name,display_attributes:{display_name:e.displayName||"",input_type:"text",order:t.length+1,value:{type:"manual"}}};return"text-continuation"===e.groupType?(r.display_attributes.input_type="text",r.pdf_attributes=[{formType:n,formfield:i.name,linked_form_fields_text:e.fields.slice(1).map(e=>e.name)}]):"text-same-value"===e.groupType?(r.display_attributes.input_type="text",r.pdf_attributes=e.fields.map(e=>({formType:n,formfield:e.name}))):"checkbox"===e.groupType?(r.display_attributes.input_type="checkbox",r.display_attributes.checkbox_options={options:e.fields.map(e=>({display_name:e.name,databaseStored:e.name,linkedFields:[]}))},r.pdf_attributes=[{formType:n,formfield:i.name,linked_form_fields_checkbox:e.fields.map(e=>({fromDatabase:e.name,pdfAttribute:e.name}))}]):"radio"===e.groupType&&(r.display_attributes.input_type="radio",r.display_attributes.display_radio_options=e.fields.map(e=>e.name),r.pdf_attributes=[{formType:n,formfield:e.fields.map(e=>e.name),linked_form_fields_radio:e.fields.map(e=>({radioField:e.name,displayName:e.name}))}]),r})(d);u(e),p(e.unique_id)}},[d]);let x=e=>{c&&e.unique_id===c.unique_id?(i([...t,e]),u(null)):i(t.map(t=>t.unique_id===e.unique_id?e:t)),p(null)};return(0,r.jsxs)("div",{style:{height:"100%",overflow:"auto",padding:"20px"},children:[(0,r.jsx)("h2",{children:"Schema Editor"}),c&&s===c.unique_id&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"New Schema Item"}),(0,r.jsx)(m,{item:c,onSave:x,onCancel:()=>p(null),onStartLinking:a,linkingMode:l})]}),t.map(e=>(0,r.jsx)("div",{style:{border:"1px solid #d1d5db",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:s===e.unique_id?(0,r.jsx)(m,{item:e,onSave:x,onCancel:()=>p(null),onStartLinking:a,linkingMode:l}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:e.display_attributes.display_name||e.unique_id}),(0,r.jsxs)("div",{style:{fontSize:"14px",color:"#6b7280"},children:["Type: ",e.display_attributes.input_type," | Order: ",e.display_attributes.order]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,r.jsx)("button",{onClick:()=>p(e.unique_id),style:{padding:"4px 8px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer",fontSize:"14px"},children:"Edit"}),(0,r.jsx)("button",{onClick:()=>{var r;return r=e.unique_id,void i(t.filter(e=>e.unique_id!==r))},style:{padding:"4px 8px",border:"1px solid #ef4444",borderRadius:"4px",background:"#fee2e2",color:"#dc2626",cursor:"pointer",fontSize:"14px"},children:"Delete"})]})]})})},e.unique_id)),0===t.length&&!c&&(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#6b7280"},children:"Select fields from the PDF to create schema items."})]})}function _(e){let{schema:t,formType:i}=e,d=()=>{let e=i.replace(/[^a-zA-Z0-9]/g,"_"),r=JSON.stringify(t,(e,t)=>{if("operation"!==e&&"reverseOperation"!==e)return t},2);return"import { Schema, SchemaItem } from '@/types/schema';\n\nexport const ".concat(e,"_schema: Schema = ").concat(r,";\n\nexport default ").concat(e,"_schema;")};return(0,r.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)("div",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",display:"flex",gap:"10px",alignItems:"center"},children:[(0,r.jsx)("h3",{style:{margin:0,flex:1},children:"TypeScript Schema Export"}),(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(d()),alert("Schema copied to clipboard!")},style:{padding:"6px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer"},children:"Copy to Clipboard"}),(0,r.jsx)("button",{onClick:()=>{let e=new Blob([d()],{type:"text/typescript"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="".concat(i,"_schema.ts"),r.click(),URL.revokeObjectURL(t)},style:{padding:"6px 12px",border:"none",borderRadius:"4px",background:"#2563eb",color:"white",cursor:"pointer"},children:"Download .ts"}),(0,r.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),d=document.createElement("a");d.href=r,d.download="".concat(i,"_schema.json"),d.click(),URL.revokeObjectURL(r)},style:{padding:"6px 12px",border:"none",borderRadius:"4px",background:"#10b981",color:"white",cursor:"pointer"},children:"Download .json"})]}),(0,r.jsx)("pre",{style:{flex:1,margin:0,padding:"20px",background:"#1e293b",color:"#e2e8f0",overflow:"auto",fontSize:"14px",lineHeight:"1.5"},children:(0,r.jsx)("code",{children:d()})})]})}async function v(e,t){if(!("indexedDB"in window))throw Error("IndexedDB not available");let i=await new Promise((e,t)=>{let i=indexedDB.open("pdf-storage",2);i.onupgradeneeded=()=>{let e=i.result;e.objectStoreNames.contains("pdfs")||e.createObjectStore("pdfs"),e.objectStoreNames.contains("schemas")||e.createObjectStore("schemas")},i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)});await new Promise((r,d)=>{let o=i.transaction("schemas","readwrite").objectStore("schemas").put(t,e);o.onsuccess=()=>r(),o.onerror=()=>d(o.error)})}async function j(e){if(!("indexedDB"in window))return null;let t=await new Promise((e,t)=>{let i=indexedDB.open("pdf-storage",2);i.onupgradeneeded=()=>{let e=i.result;e.objectStoreNames.contains("pdfs")||e.createObjectStore("pdfs"),e.objectStoreNames.contains("schemas")||e.createObjectStore("schemas")},i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)});return await new Promise((i,r)=>{let d=t.transaction("schemas","readonly").objectStore("schemas").get(e);d.onsuccess=()=>i(d.result||null),d.onerror=()=>r(d.error)})}function k(){let e=(0,d.useParams)(),t=(0,o.useMemo)(()=>{var t,i;return String(null!=(i=null!=(t=null==e?void 0:e.projectId)?t:null==e?void 0:e.projectid)?i:"unknown")},[e]),i=(0,u.b)(e=>e.projects).find(e=>e.id===t),n=(null==i?void 0:i.formType)||"default",[a,l]=(0,o.useState)(null),[s,x]=(0,o.useState)(null),[b,h]=(0,o.useState)(null),[m,k]=(0,o.useState)(null),[w,S]=(0,o.useState)([]),[C,B]=(0,o.useState)(new Set),[R,T]=(0,o.useState)([]),[F,P]=(0,o.useState)(!1),[D,L]=(0,o.useState)(),[N,O]=(0,o.useState)("editor"),[E,q]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=!0;return(async()=>{let i=await p(t);e&&i&&(l(i),h("Loaded PDF from storage"));let r=await j(t);e&&r&&S(r)})(),()=>{e=!1}},[t]),(0,o.useEffect)(()=>{w.length>0&&v(t,w).catch(console.error)},[w,t]);let A=(0,o.useCallback)(async e=>{x(null),h(null);let i=e&&e[0];if(i){if("application/pdf"!==i.type)return void x("Please upload a PDF file.");if(i.size>0x1400000)return void x("File too large. Max size is 20 MB. Selected: ".concat(function(e){let t=["B","KB","MB","GB"],i=0;for(;e>=1024&&i<t.length-1;)e/=1024,i++;return"".concat(e.toFixed(2)," ").concat(t[i])}(i.size)));try{k(i.name);let e=await i.arrayBuffer();l(e);let r=await c(t,e);h("Saved to ".concat(r))}catch(e){console.error(e),x((null==e?void 0:e.message)||"Failed to read/save file.")}}},[t]);(0,o.useCallback)(e=>{var t;e.preventDefault(),e.stopPropagation();let i=e.dataTransfer;(null==i||null==(t=i.files)?void 0:t.length)&&A(i.files)},[A]),(0,o.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]);let z=(0,o.useCallback)(e=>{e.target.files&&A(e.target.files)},[A]);return a?(0,r.jsxs)("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)("div",{style:{padding:"10px 20px",borderBottom:"1px solid #e5e7eb",background:"#f9fafb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("h1",{style:{margin:0,fontSize:"20px"},children:["Project: ",(null==i?void 0:i.name)||t," (",n,")"]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[C.size>0&&(0,r.jsxs)("button",{onClick:()=>{P(!0)},style:{padding:"8px 16px",background:"#2563eb",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:["Create Group (",C.size," fields selected)"]}),(0,r.jsx)("button",{onClick:()=>B(new Set),style:{padding:"8px 16px",background:"white",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer"},disabled:0===C.size,children:"Clear Selection"}),E&&(0,r.jsx)("button",{onClick:()=>q(null),style:{padding:"8px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Cancel Linking Mode"})]})]}),(0,r.jsxs)("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[(0,r.jsxs)("div",{style:{flex:1,borderRight:"1px solid #e5e7eb"},children:[E&&(0,r.jsx)("div",{style:{padding:"10px",background:"#fef3c7",borderBottom:"1px solid #fbbf24",fontSize:"14px"},children:"\uD83D\uDD17 Linking Mode Active: Click on a grouped field in the PDF to link it"}),(0,r.jsx)(f,{pdfData:a,onFieldsExtracted:T,selectedFields:C,onFieldClick:e=>{if(E){let t=w.find(t=>{var i;return null==(i=t.pdf_attributes)?void 0:i.some(t=>{var i;return t.formfield===e.name||Array.isArray(t.formfield)&&t.formfield.includes(e.name)||(null==(i=t.linked_form_fields_text)?void 0:i.includes(e.name))})});if(t){let[e,i]=E.checkboxOptionPath.split(".");S(w.map(r=>{if(r.unique_id===e&&r.display_attributes.checkbox_options){let e=[...r.display_attributes.checkbox_options.options];return e[parseInt(i)]&&(e[parseInt(i)].linkedFields||(e[parseInt(i)].linkedFields=[]),e[parseInt(i)].linkedFields.includes(t.unique_id)||e[parseInt(i)].linkedFields.push(t.unique_id)),{...r,display_attributes:{...r.display_attributes,checkbox_options:{...r.display_attributes.checkbox_options,options:e}}}}return r})),q(null),alert("Linked to ".concat(t.display_attributes.display_name||t.unique_id))}else alert("This field is not part of any schema group yet. Please create a group first.");return}let t=new Set(C);t.has(e.name)?t.delete(e.name):t.add(e.name),B(t)},groupedFields:(()=>{let e=new Set;return w.forEach(t=>{var i;null==(i=t.pdf_attributes)||i.forEach(t=>{var i,r,d;"string"==typeof t.formfield?e.add(t.formfield):Array.isArray(t.formfield)&&t.formfield.forEach(t=>e.add(t)),null==(i=t.linked_form_fields_text)||i.forEach(t=>e.add(t)),null==(r=t.linked_form_fields_checkbox)||r.forEach(t=>e.add(t.pdfAttribute)),null==(d=t.linked_form_fields_radio)||d.forEach(t=>e.add(t.radioField))})}),e})(),linkingMode:!!E})]}),(0,r.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[(0,r.jsxs)("div",{style:{display:"flex",borderBottom:"1px solid #e5e7eb",background:"#f9fafb"},children:[(0,r.jsx)("button",{onClick:()=>O("editor"),style:{padding:"10px 20px",background:"editor"===N?"white":"transparent",border:"none",borderBottom:"editor"===N?"2px solid #2563eb":"none",cursor:"pointer",fontWeight:"editor"===N?"bold":"normal"},children:"Schema Editor"}),(0,r.jsx)("button",{onClick:()=>O("typescript"),style:{padding:"10px 20px",background:"typescript"===N?"white":"transparent",border:"none",borderBottom:"typescript"===N?"2px solid #2563eb":"none",cursor:"pointer",fontWeight:"typescript"===N?"bold":"normal"},children:"TypeScript Export"})]}),(0,r.jsx)("div",{style:{flex:1,overflow:"auto"},children:"editor"===N?(0,r.jsx)(g,{schema:w,onSchemaChange:S,fieldGroup:D,formType:n,onStartLinking:e=>q({checkboxOptionPath:e}),linkingMode:E}):(0,r.jsx)(_,{schema:w,formType:n})})]})]}),F&&(0,r.jsx)(y,{selectedFields:R.filter(e=>C.has(e.name)),onCreateGroup:e=>{L(e),P(!1),B(new Set)},onCancel:()=>P(!1)})]}):(0,r.jsxs)("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsxs)("div",{style:{maxWidth:500,width:"100%",padding:24,borderRadius:8,border:"2px dashed #d1d5db",textAlign:"center",background:"#fafafa",cursor:"pointer"},onClick:()=>{let e=document.getElementById("pdf-input");null==e||e.click()},role:"button","aria-label":"Upload PDF",children:[(0,r.jsx)("p",{style:{marginBottom:8},children:"Drag and drop a PDF here, or click to select"}),(0,r.jsx)("input",{id:"pdf-input",type:"file",accept:"application/pdf",style:{display:"none"},onChange:z}),(0,r.jsx)("p",{style:{fontSize:12,color:"#666"},children:"Max size: 20 MB"})]}),s&&(0,r.jsx)("div",{style:{color:"#b00020",marginTop:12},children:s}),b&&(0,r.jsx)("div",{style:{color:"#0a7",marginTop:12},children:b})]})}},9706:(e,t,i)=>{"use strict";i.d(t,{b:()=>o});var r=i(3401),d=i(4350);let o=(0,r.v)()((0,d.Zr)(e=>({projects:[],addProject:t=>{var i;let r=null!=(i=t.id)?i:Math.random().toString(36).slice(2,10);return e(e=>({projects:[...e.projects,{id:r,name:t.name,formType:t.formType}]})),r},renameProject:(t,i)=>e(e=>({projects:e.projects.map(e=>e.id===t?{...e,name:i}:e)})),deleteProject:t=>e(e=>({projects:e.projects.filter(e=>e.id!==t)})),replaceAll:t=>e({projects:t})}),{name:"psb_projects",version:1,partialize:e=>({projects:e.projects}),migrate:e=>e||{projects:[]}}))}},e=>{e.O(0,[233,347,508,358],()=>e(e.s=2124)),_N_E=e.O()}]);